<?xml version="1.0" encoding="UTF-8"?>
<Wix
	xmlns="http://schemas.microsoft.com/wix/2006/wi"
	xmlns:netfx="http://schemas.microsoft.com/wix/NetFxExtension"
	>
	<?include $(sys.CURRENTDIR)Setup.autogenerated.wxi ?>
	<!-- Change the product code with every new version. Change the upgrade code only if it is a very different version, which should be allowed to install in parallel to an older version -->
	<Product	Id="*"
						Codepage="1252"
						Language="1033"
						Manufacturer="Dr. Dirk Lellinger"
						Name="Altaxo"
						UpgradeCode="$(var.UpgradeCode)"
						Version="$(var.VersionNumber)">
		<Package	Comments="Altaxo data analysis and plotting program"
							Compressed="yes"
							InstallerVersion="200"
							Keywords="plotting,data processing, special functions, graph, fitting"
							Languages="1033"
							Manufacturer="Dr. Dirk Lellinger"
							Platform="x86" />

		<MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
		<PropertyRef Id="NETFRAMEWORK40FULL"/>
		<Media Id='1' Cabinet='Altaxo.cab' EmbedCab='yes'/>

		<Condition Message="This application requires .NET Framework 4.0 (full version). Please install the .NET Framework then run this installer again.">
			<![CDATA[Installed OR NETFRAMEWORK40FULL]]>
		</Condition>

		<Feature Id="Complete" Title="Altaxo" Level="1" ConfigurableDirectory='APPLICATIONFOLDER' Description='The complete Altaxo package.' Display='expand' >
			<ComponentGroupRef Id="AltaxoFiles" />
			<ComponentRef Id="ProgramMenuDir"/>
			<ComponentRef Id="ApplicationShortcut"/>
			<ComponentRef Id="DesktopShortcut"/>
			<ComponentRef Id="Extensions"/>
		</Feature>
	</Product>

	<Fragment>
		<Directory Id="TARGETDIR" Name="SourceDir">
			<Directory Id="ProgramFilesFolder">
				<Directory Id="APPLICATIONFOLDER" Name="Altaxo" />
			</Directory>
			<Directory Id="DesktopFolder"/>
			<Directory Id="ProgramMenuFolder" >
				<Directory Id="ProgramMenuDir" Name="Altaxo" >
					<Component Id="ProgramMenuDir" Guid="0C29D761-C54B-427C-B167-340AE017D097">
						<RemoveFolder Id="ProgramMenuDir" On="uninstall"/>
						<RegistryValue Root="HKCU" Key="Software\[Manufacturer]\[ProductName]" Name="ProgramMenuDirInstalled" Type="integer" Value="1" KeyPath="yes"/>
					</Component>
				</Directory>
			</Directory>
		</Directory>
	</Fragment>
	<Fragment>


		<DirectoryRef Id="ProgramMenuDir">
			<!-- add an Icon for the Program menu -->
			<Component Id="ApplicationShortcut" Guid="A0BDE395-0895-4C0E-AC9C-94B8F6E5FB71">
				<Shortcut Id="ApplicationStartMenuShortcut" Name="Altaxo" Description="Altaxo plotting and data analysis program" Target="[APPLICATIONFOLDER]bin\AltaxoStartup.exe" WorkingDirectory="APPLICATIONFOLDER"/>
				<RegistryValue Root="HKCU" Key="Software\[Manufacturer]\[ProductName]" Name="ProgramMenuIconInstalled" Type="integer" Value="1" KeyPath="yes"/>
			</Component>
		</DirectoryRef>

		<DirectoryRef Id="DesktopFolder">
			<!-- add an Icon to the desktop -->
			<Component Id="DesktopShortcut" Guid="0778E72C-27EE-42F5-910D-5CD4CBBAF1B1">
				<Shortcut Id="ApplicationDesktopShortcut" Name="Altaxo" Description="Altaxo plotting and data analysis program" Target="[APPLICATIONFOLDER]bin\AltaxoStartup.exe" WorkingDirectory="APPLICATIONFOLDER"/>
				<RegistryValue Root="HKCU" Key="Software\[Manufacturer]\[ProductName]" Name="DesktopIconInstalled" Type="integer" Value="1" KeyPath="yes"/>
			</Component>
		</DirectoryRef>

		<DirectoryRef Id="dirBD35FD5C001808C2DA6BDBD555B2851B">
			<Component Id="Extensions" Guid="21EA7312-D8B6-4B3E-B79D-732293412642">
				<ProgId Id="AltaxoDocument" Description="Altaxo document" Icon="filA05E81D60406FC97A60A59138305091A" IconIndex="0">
					<Extension Id="axoprj">
						<!-- The trick to use a TargetProperty instead of a TargetFile is described here: http://windows-installer-xml-wix-toolset.687559.n2.nabble.com/Problem-with-file-association-and-harvesting-files-td7016927.html -->
						<Verb Id="open" Command="&amp;Open" Argument="&quot;%1&quot;" TargetProperty="FileAssociationProperty" /> 
					</Extension>
				</ProgId>
				<RegistryValue Root="HKLM" Key="Software\[Manufacturer]\[ProductName]" Name="AltaxoVerbInstalled" Type="integer" Value="1" KeyPath="yes"/>
			</Component>
		</DirectoryRef>

		<SetProperty Id="FileAssociationProperty" Value="[APPLICATIONFOLDER]bin\AltaxoStartup.exe" After="CostFinalize" />



		<!-- Install for all users.
			Using ALLUSERS=2 means the application can be installed by a non-admin. 
			In this case it will be a per-user installation installed into the 
			user's personal profile. 

			
			http://msdn.microsoft.com/library/default.asp?url=/library/en-us/msi/setup/allusers.asp
		-->
		<Property Id="ALLUSERS">2</Property>

		<!-- 
			Support entries shown when clicking "Click here for support information"
			in Control Panel's Add/Remove Programs

			http://msdn.microsoft.com/library/default.asp?url=/library/en-us/msi/setup/configuration_properties.asp
		-->
		<Property Id="ARPCONTACT">http://altaxo.sourceforge.net</Property>
		<Property Id="ARPHELPLINK">http://sourceforge.net/projects/altaxo/support</Property>
		<Property Id="ARPURLINFOABOUT">http://altaxo.sourceforge.net</Property>
		<Property Id="ARPURLUPDATEINFO">http://sourceforge.net/projects/altaxo/files/</Property>

		<Property Id="ARPPRODUCTICON" Value="AltaxoIcon.exe" />
		<Icon Id="AltaxoIcon.exe" SourceFile="$(var.AxoSrcDir)\bin\AltaxoStartup.exe" />

		<Property Id="ApplicationFolderName" Value="Altaxo" />
		<Property Id="WixAppFolder" Value="WixPerMachineFolder" />



		<UIRef Id="WixUI_Mondo" />
		<UIRef Id="WixUI_ErrorProgressText" />

		<WixVariable Id="WixUILicenseRtf" Value="License.rtf" />
		<WixVariable Id="WixUIBannerBmp" Value="Bitmaps\Banner.bmp" />
		<!-- Top banner, 493 x 58 pixel-->
		<WixVariable Id="WixUIDialogBmp" Value="Bitmaps\Dialog.bmp" />
		<!-- Background bitmap, 493 x 312 pixel-->


	</Fragment>





</Wix>