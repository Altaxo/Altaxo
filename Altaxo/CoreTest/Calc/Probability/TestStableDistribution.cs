#region Copyright
/////////////////////////////////////////////////////////////////////////////
//    Altaxo:  a data processing and data plotting program
//    Copyright (C) 2002-2007 Dr. Dirk Lellinger
//
//    This program is free software; you can redistribute it and/or modify
//    it under the terms of the GNU General Public License as published by
//    the Free Software Foundation; either version 2 of the License, or
//    (at your option) any later version.
//
//    This program is distributed in the hope that it will be useful,
//    but WITHOUT ANY WARRANTY; without even the implied warranty of
//    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//    GNU General Public License for more details.
//
//    You should have received a copy of the GNU General Public License
//    along with this program; if not, write to the Free Software
//    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
//
/////////////////////////////////////////////////////////////////////////////
#endregion

using System;
using Altaxo.Calc;
using Altaxo.Calc.Probability;
using NUnit.Framework;


namespace AltaxoTest.Calc.Probability
{
  [TestFixture]
  public class TestStableDistribution
  {
    #region PDF test data
    /* Mathematica code to create the table following (use the stable packet from the mathematica library web site)
    
     << StableDistribution`SMath`
    
    flarguments = Flatten[ Table[
      {
        {1/2, 7/8, 1, 9/8, 3/2, 2}[[i]],
        {-1, -1/2, 0, 1/2, 1}[[j]],
        {-10, -4, -1/2, 0, 1/2, 4, 10}[[k]]
        }, {i, 1, 6}, {j, 1, 5}, {k, 1, 7}], 2]
    
    For[i = 1, i ? Length[flarguments], i += 1,
  alpha = flarguments[[i]][[1]];
  beta = flarguments[[i]][[2]];
  xx = flarguments[[i]][[3]];
  yy = N[SPDF[xx, {
   alpha, beta}, 0, GaussPoints -> 30, MaxRecursion -> 10, WorkingPrecision ->
     64], 18];
  If[NumericQ[yy],
    Print[alpha, " ", beta, " ", xx, " ", yy];
    strm = OpenAppend["C:\\TEMP\\output.txt", CharacterEncoding -> "
          ASCII", FormatType -> OutputForm];
    Write[strm, 
        "new double[]{", FortranForm[alpha], ",", FortranForm[beta], ",", 
  FortranForm[xx], ",", FortranForm[yy], "},"];
     Close[strm]
    ];
  ]
    */

    double[][] _pdfTestS0 = new double[][]{
new double[]{0.5,-1,-10,0.010449135953590293},
new double[]{0.5,-1,-4,0.032286845174307237},
new double[]{0.5,-1,-0.5,0.155599554757086521},
new double[]{0.5,-1,0,0.24197072451914335},
new double[]{0.5,-1,0.5,0.415107497420594703},
new double[]{0.5,-1,4,0.0e-64},
new double[]{0.5,-1,10,0.0e-65},
new double[]{0.5,-0.5,-10,0.0075881394617841676},
new double[]{0.5,-0.5,-4,0.0245663001715312596},
new double[]{0.5,-0.5,-0.5,0.159240297087939965},
new double[]{0.5,-0.5,0,0.311533168758699187},
new double[]{0.5,-0.5,0.5,0.305577490736439045},
new double[]{0.5,-0.5,4,0.00825895136238823702},
new double[]{0.5,-0.5,10,0.00233372277449640175},
new double[]{0.5,0,-10,0.00487225538372111616},
new double[]{0.5,0,-4,0.0165057384221262866},
new double[]{0.5,0,-0.5,0.170762401725206224},
new double[]{0.5,0,0,0.636619772367581343},
new double[]{0.5,0,0.5,0.170762401725206224},
new double[]{0.5,0,4,0.0165057384221262866},
new double[]{0.5,0,10,0.00487225538372111616},
new double[]{0.5,0.5,-10,0.00233372277449640175},
new double[]{0.5,0.5,-4,0.00825895136238823702},
new double[]{0.5,0.5,-0.5,0.305577490736439045},
new double[]{0.5,0.5,0,0.311533168758699187},
new double[]{0.5,0.5,0.5,0.159240297087939965},
new double[]{0.5,0.5,4,0.0245663001715312596},
new double[]{0.5,0.5,10,0.0075881394617841676},
new double[]{0.5,1,-10,0.0e-65},
new double[]{0.5,1,-4,0.0e-64},
new double[]{0.5,1,-0.5,0.415107497420594703},
new double[]{0.5,1,0,0.24197072451914335},
new double[]{0.5,1,0.5,0.155599554757086521},
new double[]{0.5,1,4,0.032286845174307237},
new double[]{0.5,1,10,0.010449135953590293},
new double[]{0.875,-1,-10,0.00859319050259130464},
new double[]{0.875,-1,-4,0.0387326900318963064},
new double[]{0.875,-1,-0.5,0.200970622845054967},
new double[]{0.875,-1,0,0.257507821327408685},
new double[]{0.875,-1,0.5,0.293063509101005356},
new double[]{0.875,-1,4,1.704436247487977e-8409},
new double[]{0.875,-1,10,0.0e-64},
new double[]{0.875,-0.5,-10,0.00604336008614330531},
new double[]{0.875,-0.5,-4,0.028960271499303109},
new double[]{0.875,-0.5,-0.5,0.21336200882206995},
new double[]{0.875,-0.5,0,0.296170740739014809},
new double[]{0.875,-0.5,0.5,0.309836819666517268},
new double[]{0.875,-0.5,4,0.00933860640361163996},
new double[]{0.875,-0.5,10,0.00174459320858150607},
new double[]{0.875,0,-10,0.00375882644917199933},
new double[]{0.875,0,-4,0.0190875070493639558},
new double[]{0.875,0,-0.5,0.245963617139043073},
new double[]{0.875,0,0,0.34029602763013595},
new double[]{0.875,0,0.5,0.245963617139043073},
new double[]{0.875,0,4,0.0190875070493639558},
new double[]{0.875,0,10,0.00375882644917199933},
new double[]{0.875,0.5,-10,0.00174459320858150607},
new double[]{0.875,0.5,-4,0.00933860640361163996},
new double[]{0.875,0.5,-0.5,0.309836819666517268},
new double[]{0.875,0.5,0,0.296170740739014809},
new double[]{0.875,0.5,0.5,0.21336200882206995},
new double[]{0.875,0.5,4,0.028960271499303109},
new double[]{0.875,0.5,10,0.00604336008614330531},
new double[]{0.875,1,-10,0.0e-64},
new double[]{0.875,1,-4,1.704436247487977e-8409},
new double[]{0.875,1,-0.5,0.293063509101005356},
new double[]{0.875,1,0,0.257507821327408685},
new double[]{0.875,1,0.5,0.200970622845054967},
new double[]{0.875,1,4,0.0387326900318963064},
new double[]{0.875,1,10,0.00859319050259130464},
new double[]{1,-1,-4,0.038364382040947077},
new double[]{1,-1,-0.5,0.212318467675064265},
new double[]{1,-1,0,0.262240126375351657},
new double[]{1,-1,0.5,0.282979296472337068},
new double[]{1,-1,4,2.40268429420551753e-54},
new double[]{1,-1,10,6.14207193080535992e-674917},
new double[]{1,-0.5,-4,0.0285478736642324839},
new double[]{1,-0.5,-0.5,0.225442218599286543},
new double[]{1,-0.5,0,0.292520470566076713},
new double[]{1,-0.5,0.5,0.292609581480539141},
new double[]{1,-0.5,4,0.00910970616999196668},
new double[]{1,-0.5,10,0.00145461336969288015},
new double[]{1,0,-10,0.00315158303152267992},
new double[]{1,0,-4,0.0187241109519876866},
new double[]{1,0,-0.5,0.254647908947032537},
new double[]{1,0,0,0.318309886183790672},
new double[]{1,0,0.5,0.254647908947032537},
new double[]{1,0,4,0.0187241109519876866},
new double[]{1,0,10,0.00315158303152267992},
new double[]{1,0.5,-10,0.00145461336969288015},
new double[]{1,0.5,-4,0.00910970616999196668},
new double[]{1,0.5,-0.5,0.292609581480539141},
new double[]{1,0.5,0,0.292520470566076713},
new double[]{1,0.5,0.5,0.225442218599286543},
new double[]{1,0.5,4,0.0285478736642324839},
new double[]{1,1,-10,6.14207193080535992e-674917},
new double[]{1,1,-4,2.40268429420551753e-54},
new double[]{1,1,-0.5,0.282979296472337068},
new double[]{1,1,0,0.262240126375351657},
new double[]{1,1,0.5,0.212318467675064265},
new double[]{1,1,4,0.038364382040947077},
new double[]{1.125,-1,-10,0.00594795968980815246},
new double[]{1.125,-1,-0.5,0.222394217418834845},
new double[]{1.125,-1,0,0.266587031169983183},
new double[]{1.125,-1,0.5,0.276735064777311314},
new double[]{1.125,-1,4,4.37746558963013643e-16},
new double[]{1.125,-1,10,8.09021799038346448e-1542},
new double[]{1.125,-0.5,-10,0.00413713556384187849},
new double[]{1.125,-0.5,-4,0.0274348398312656861},
new double[]{1.125,-0.5,-0.5,0.235222239213963157},
new double[]{1.125,-0.5,0,0.289563250722015948},
new double[]{1.125,-0.5,0.5,0.281914028906399689},
new double[]{1.125,-0.5,4,0.0086915303222026684},
new double[]{1.125,-0.5,10,0.00117258370220477812},
new double[]{1.125,0,-10,0.00254800947188242432},
new double[]{1.125,0,-4,0.0179324210975094243},
new double[]{1.125,0,-0.5,0.258708942735625721},
new double[]{1.125,0,0,0.304943370229598302},
new double[]{1.125,0,0.5,0.258708942735625721},
new double[]{1.125,0,4,0.0179324210975094243},
new double[]{1.125,0,10,0.00254800947188242432},
new double[]{1.125,0.5,-10,0.00117258370220477812},
new double[]{1.125,0.5,-4,0.0086915303222026684},
new double[]{1.125,0.5,-0.5,0.281914028906399689},
new double[]{1.125,0.5,0,0.289563250722015948},
new double[]{1.125,0.5,0.5,0.235222239213963157},
new double[]{1.125,0.5,4,0.0274348398312656861},
new double[]{1.125,0.5,10,0.00413713556384187849},
new double[]{1.125,1,-10,8.09021799038346448e-1542},
new double[]{1.125,1,-4,4.37746558963013643e-16},
new double[]{1.125,1,-0.5,0.276735064777311314},
new double[]{1.125,1,0,0.266587031169983183},
new double[]{1.125,1,0.5,0.222394217418834845},
new double[]{1.125,1,10,0.00594795968980815246},
new double[]{1.5,-1,-10,0.00241981613066309674},
new double[]{1.5,-1,-4,0.0279973178629260511},
new double[]{1.5,-1,-0.5,0.246515640532722451},
new double[]{1.5,-1,0,0.276859868856746781},
new double[]{1.5,-1,0.5,0.268368758744508534},
new double[]{1.5,-1,4,0.0000567935873875498302},
new double[]{1.5,-1,10,1.34096664947790338e-43},
new double[]{1.5,-0.5,-10,0.00169010120711345954},
new double[]{1.5,-0.5,-4,0.0207819141087301014},
new double[]{1.5,-0.5,-0.5,0.254112686602229452},
new double[]{1.5,-0.5,0,0.28428380098857753},
new double[]{1.5,-0.5,0.5,0.268046496554461533},
new double[]{1.5,-0.5,4,0.00673588721821525944},
new double[]{1.5,-0.5,10,0.000486574121093548287},
new double[]{1.5,0,-10,0.00104777602492944046},
new double[]{1.5,0,-4,0.0136729417918039395},
new double[]{1.5,0,-0.5,0.262296840354090036},
new double[]{1.5,0,0,0.287352751452164445},
new double[]{1.5,0,0.5,0.262296840354090036},
new double[]{1.5,0,4,0.0136729417918039395},
new double[]{1.5,0,10,0.00104777602492944046},
new double[]{1.5,0.5,-10,0.000486574121093548287},
new double[]{1.5,0.5,-4,0.00673588721821525944},
new double[]{1.5,0.5,-0.5,0.268046496554461533},
new double[]{1.5,0.5,0,0.28428380098857753},
new double[]{1.5,0.5,0.5,0.254112686602229452},
new double[]{1.5,0.5,4,0.0207819141087301014},
new double[]{1.5,0.5,10,0.00169010120711345954},
new double[]{1.5,1,-10,1.34096664947790338e-43},
new double[]{1.5,1,-4,0.0000567935873875498302},
new double[]{1.5,1,-0.5,0.268368758744508534},
new double[]{1.5,1,0,0.276859868856746781},
new double[]{1.5,1,0.5,0.246515640532722451},
new double[]{1.5,1,4,0.0279973178629260511},
new double[]{1.5,1,10,0.00241981613066309674},
new double[]{2,-1,-10,3.91771663275433383e-12},
new double[]{2,-1,-4,0.00516674633852301346},
new double[]{2,-1,-0.5,0.265003532344028561},
new double[]{2,-1,0,0.282094791773878143},
new double[]{2,-1,0.5,0.265003532344028561},
new double[]{2,-1,4,0.00516674633852301346},
new double[]{2,-1,10,3.91771663275433383e-12},
new double[]{2,-0.5,-10,3.91771663275433383e-12},
new double[]{2,-0.5,-4,0.00516674633852301346},
new double[]{2,-0.5,-0.5,0.265003532344028561},
new double[]{2,-0.5,0,0.282094791773878143},
new double[]{2,-0.5,0.5,0.265003532344028561},
new double[]{2,-0.5,4,0.00516674633852301346},
new double[]{2,-0.5,10,3.91771663275433383e-12},
new double[]{2,0,-10,3.91771663275433383e-12},
new double[]{2,0,-4,0.00516674633852301346},
new double[]{2,0,-0.5,0.265003532344028561},
new double[]{2,0,0,0.282094791773878143},
new double[]{2,0,0.5,0.265003532344028561},
new double[]{2,0,4,0.00516674633852301346},
new double[]{2,0,10,3.91771663275433383e-12},
new double[]{2,0.5,-10,3.91771663275433383e-12},
new double[]{2,0.5,-4,0.00516674633852301346},
new double[]{2,0.5,-0.5,0.265003532344028561},
new double[]{2,0.5,0,0.282094791773878143},
new double[]{2,0.5,0.5,0.265003532344028561},
new double[]{2,0.5,4,0.00516674633852301346},
new double[]{2,0.5,10,3.91771663275433383e-12},
new double[]{2,1,-10,3.91771663275433383e-12},
new double[]{2,1,-4,0.00516674633852301346},
new double[]{2,1,-0.5,0.265003532344028561},
new double[]{2,1,0,0.282094791773878143},
new double[]{2,1,0.5,0.265003532344028561},
new double[]{2,1,4,0.00516674633852301346},
new double[]{2,1,10,3.91771663275433383e-12}
};
    #endregion

    [Test]
    public void PdfTest()
    {
      for (int i = 0; i < _pdfTestS0.Length; i++)
      {
        double alpha = _pdfTestS0[i][0];
        double beta = _pdfTestS0[i][1];
        double x = _pdfTestS0[i][2];
        double expectedy = _pdfTestS0[i][3];
        double y = StableDistributionS0.PDF(x, alpha, beta);
        double maxdelta = Math.Abs(expectedy / 1E7);
        maxdelta = Math.Max(maxdelta, 1e-25);
        string msg = string.Format("i={0}, alpha={1}, beta={2}, x={3}, expected={4}, actual={5}", i,alpha, beta, x, expectedy, y);
        Assert.AreEqual(expectedy, y, maxdelta, msg);
      }
    }

    [Test]
    public void PdfTestSpec()
    {
      int i = 140; 
      {
        double alpha = _pdfTestS0[i][0];
        double beta = _pdfTestS0[i][1];
        double x = _pdfTestS0[i][2];
        double expectedy = _pdfTestS0[i][3];
        double y = StableDistributionS0.PDF(x, alpha, beta);
        double maxdelta = Math.Abs(expectedy / 1E7);
        maxdelta = Math.Max(maxdelta, 1e-25);
        string msg = string.Format("i={0}, alpha={1}, beta={2}, x={3}, expected={4}, actual={5}", i, alpha, beta, x, expectedy, y);
        Assert.AreEqual(expectedy, y, maxdelta, msg);
      }
    }

    #region Test S1

    /* The following Mathematica code was used to generate the table (Note here that sigma=1.7 and mu=3/7)
     * The output text must be further processed by replacing " with nothing and 0.e with 0.0e
     
     << "StableDistribution`SMath`"
     
     flarguments = Flatten[Table[{
        {3/16, 7/8, 1, 9/8, 17/10, 2}[[i]],
        {-1, -4^(-1), 0, 3/8, 1}[[j]],
        {-10, -4, -2^(-1), 0, 1/2, 4, 10}[[k]]},
      {i, 1, 6}, {j, 1, 5}, {k, 1, 7}], 2]
     
     For[i = 1, i <= Length[flarguments], i += 1, alpha = flarguments[[i]][[1]]; 
   beta = flarguments[[i]][[2]]; xx = flarguments[[i]][[3]]; 
   yy = N[SPDF[xx, {alpha, beta, 17/10, 3/7}, 1, GaussPoints -> 30, MaxRecursion -> 10, WorkingPrecision -> 64], 18]; 
   If[NumericQ[yy], Print[alpha, " ", beta, " ", xx, " ", yy]; 
     strm = OpenAppend["C:\\TEMP\\outputS1.txt", CharacterEncoding->"ASCII", FormatType ->CForm];
     Write[strm, "new double[]{", 
     alpha, ",", beta, ",", xx, ",", yy, "},"]; Close[strm]]; ]
     
   */

    double[][] _pdfTestS1 = new double[][]{
new double[]{0.1875,-1,-10,0.0062770180013548},
new double[]{0.1875,-1,-4,0.0155315416430183},
new double[]{0.1875,-1,-0.5,0.07665072},
new double[]{0.1875,-1,0.5,0.0e-9},
new double[]{0.1875,-1,4,0.0e-16},
new double[]{0.1875,-1,10,0.0e-16},
new double[]{0.1875,-0.25,-10,0.0038144443774004},
new double[]{0.1875,-0.25,-4,0.009424300650895},
new double[]{0.1875,-0.25,-0.5,0.046524289},
new double[]{0.1875,-0.25,0.5,0.303242238},
new double[]{0.1875,-0.25,4,0.0068937017412486},
new double[]{0.1875,-0.25,10,0.0024502977157998},
new double[]{0.1875,0,-10,0.0030180829221758},
new double[]{0.1875,0,-4,0.0074483868801408},
new double[]{0.1875,0,-0.5,0.036706661},
new double[]{0.1875,0,0.5,0.411882603},
new double[]{0.1875,0,4,0.0093178545126279},
new double[]{0.1875,-1,-10,0.00627701800135476598},
new double[]{0.1875,-1,-4,0.0155315416430182922},
new double[]{0.1875,-1,-0.5,0.0766507202895227784},
new double[]{0.1875,-1,0,0.163347276150841532},
new double[]{0.1875,-1,0.5,0.0e-63},
new double[]{0.1875,-1,4,0.0e-65},
new double[]{0.1875,-1,10,0.0e-66},
new double[]{0.1875,-0.25,-10,0.00381444437740038338},
new double[]{0.1875,-0.25,-4,0.0094243006508950103},
new double[]{0.1875,-0.25,-0.5,0.0465242891643534304},
new double[]{0.1875,-0.25,0,0.0994142691020737488},
new double[]{0.1875,-0.25,0.5,0.30324223808190638},
new double[]{0.1875,-0.25,4,0.00689370174124854798},
new double[]{0.1875,-0.25,10,0.00245029771579979697},
new double[]{0.1875,0,-10,0.00301808292217582277},
new double[]{0.1875,0,-4,0.00744838688014080708},
new double[]{0.1875,0,-0.5,0.0367066606914877921},
new double[]{0.1875,0,0,0.078397440755632289},
new double[]{0.1875,0,0.5,0.411882602691635537},
new double[]{0.1875,0,4,0.00931785451262787891},
new double[]{0.1875,0,10,0.00330647826582729957},
new double[]{0.1875,0.375,-10,0.00185249646154681824},
new double[]{0.1875,0.375,-4,0.0045615215291062226},
new double[]{0.1875,0.375,-0.5,0.0223850371640671452},
new double[]{0.1875,0.375,0,0.0477157864175327861},
new double[]{0.1875,0.375,0.5,0.576680019739515356},
new double[]{0.1875,0.375,4,0.0130469768240071486},
new double[]{0.1875,0.375,10,0.00462156207508126092},
new double[]{0.1875,1,-10,0.0e-66},
new double[]{0.1875,1,-4,0.0e-65},
new double[]{0.1875,1,-0.5,0.0e-65},
new double[]{0.1875,1,0,0.0e-64},
new double[]{0.1875,1,0.5,0.841175510154875941},
new double[]{0.1875,1,4,0.0194396549151400933},
new double[]{0.1875,1,10,0.00687884237110329151},
new double[]{0.875,-1,-10,0.0846016067676838151},
new double[]{0.875,-1,-4,1.20238663588553112e-12},
new double[]{0.875,-1,-0.5,6.51729227048908141e-700323},
new double[]{0.875,-1,0,5.6823974344173017e-156980181},
new double[]{0.875,-1,0.5,0.0e-62},
new double[]{0.875,-1,4,0.0e-64},
new double[]{0.875,-1,10,0.0e-64},
new double[]{0.875,-0.25,-10,0.0101565152578798568},
new double[]{0.875,-0.25,-4,0.0637482918033682898},
new double[]{0.875,-0.25,-0.5,0.127265650796516667},
new double[]{0.875,-0.25,0,0.0838251203833049271},
new double[]{0.875,-0.25,0.5,0.0572456218962755353},
new double[]{0.875,-0.25,4,0.011385943799519284},
new double[]{0.875,-0.25,10,0.00314401030005104195},
new double[]{0.875,0,-10,0.00532576438776965663},
new double[]{0.875,0,-4,0.0228252795141123461},
new double[]{0.875,0,-0.5,0.137741140023149456},
new double[]{0.875,0,0,0.181611241663272182},
new double[]{0.875,0,0.5,0.199595514084174659},
new double[]{0.875,0,4,0.0318678251584718415},
new double[]{0.875,0,10,0.00619868574036678325},
new double[]{0.875,0.375,-10,0.00195273986211850649},
new double[]{0.875,0.375,-4,0.00560006119572872875},
new double[]{0.875,0.375,-0.5,0.017192061678680327},
new double[]{0.875,0.375,0,0.021809129714919219},
new double[]{0.875,0.375,0.5,0.0286855325222567997},
new double[]{0.875,0.375,4,0.159654071188720201},
new double[]{0.875,0.375,10,0.0173024022690566394},
new double[]{0.875,1,-10,0.0e-64},
new double[]{0.875,1,-4,0.0e-64},
new double[]{0.875,1,-0.5,0.0e-63},
new double[]{0.875,1,0,0.0e-63},
new double[]{0.875,1,0.5,0},
new double[]{0.875,1,4,5.36564983092196331e-56},
new double[]{0.875,1,10,0.111777913037468706},
new double[]{1,-1,-10,0.0120552004436318654},
new double[]{1,-1,-4,0.049016381747578651},
new double[]{1,-1,-0.5,0.142687224367128198},
new double[]{1,-1,0,0.15833461078777093},
new double[]{1,-1,0.5,0.166711271814586233},
new double[]{1,-1,4,0.0000249340278025387455},
new double[]{1,-1,10,3.86941073315465093e-1198},
new double[]{1,-0.25,-4,0.0303893662273338555},
new double[]{1,-0.25,-0.5,0.143283945350819442},
new double[]{1,-0.25,0,0.171330882008686793},
new double[]{1,-0.25,0.5,0.185391461319831204},
new double[]{1,-0.25,4,0.0264578912420336237},
new double[]{1,-0.25,10,0.00403780127187195812},
new double[]{1,0,-10,0.00484684770420661735},
new double[]{1,0,-4,0.0240476809743334116},
new double[]{1,0,-0.5,0.1442141494567049},
new double[]{1,0,0,0.176052144738793991},
new double[]{1,0,0.5,0.186911134351542104},
new double[]{1,0,4,0.0345876175879648882},
new double[]{1,0,10,0.00572607356678920551},
new double[]{1,0.375,-10,0.00275750401049915479},
new double[]{1,0.375,-4,0.0146506351430351638},
new double[]{1,0.375,-0.5,0.147980273385360836},
new double[]{1,0.375,0,0.178437814055591272},
new double[]{1,0.375,0.5,0.181097525163139653},
new double[]{1,0.375,4,0.0461902037618226076},
new double[]{1,0.375,10,0.00858043138767135289},
new double[]{1,1,-10,9.25200655863175766e-2646},
new double[]{1,1,-4,8.04879458783656752e-11},
new double[]{1,1,-0.5,0.144309718196504826},
new double[]{1,1,0,0.164402760047357055},
new double[]{1,1,0.5,0.165442602392110853},
new double[]{1,1,4,0.0636383788143668392},
new double[]{1,1,10,0.0141597189307400697},
new double[]{1.125,-1,-10,0.00275805127246462398},
new double[]{1.125,-1,-4,0.00621457746355105584},
new double[]{1.125,-1,-0.5,0.011763229084054842},
new double[]{1.125,-1,0,0.0130697606552725499},
new double[]{1.125,-1,10,0.159427320043951073},
new double[]{1.125,-0.25,-10,0.00372755304258231479},
new double[]{1.125,-0.25,-4,0.0142929252359373756},
new double[]{1.125,-0.25,-0.5,0.0531267371403108003},
new double[]{1.125,-0.25,0,0.0670092065738594514},
new double[]{1.125,-0.25,4,0.123765166729720294},
new double[]{1.125,-0.25,10,0.00642270104670531278},
new double[]{1.125,0,-10,0.00427078668053826101},
new double[]{1.125,0,-4,0.025001744235344046},
new double[]{1.125,0,-0.5,0.14773450969998548},
new double[]{1.125,0,0,0.171712490226065321},
new double[]{1.125,0,0.5,0.179157641665684126},
new double[]{1.125,0,4,0.0371674516650404853},
new double[]{1.125,0,10,0.00512797692036771519},
new double[]{1.125,0.375,-10,0.00563642119196431157},
new double[]{1.125,0.375,-4,0.14268478987618342},
new double[]{1.125,0.375,-0.5,0.0782270219957517699},
new double[]{1.125,0.375,0,0.0627918896921382113},
new double[]{1.125,0.375,4,0.0148331285716525878},
new double[]{1.125,0.375,10,0.00403393592987142387},
new double[]{1.125,1,-10,0.11535526619901388},
new double[]{1.125,1,4,0.00716343552294562378},
new double[]{1.125,1,10,0.00304894224458085392},
new double[]{1.7,-1,-10,0.00235003908061798381},
new double[]{1.7,-1,-4,0.0248082240127128557},
new double[]{1.7,-1,-0.5,0.118709745930330614},
new double[]{1.7,-1,0,0.136809677869491556},
new double[]{1.7,-1,0.5,0.15205760706429258},
new double[]{1.7,-1,4,0.0778416960809115437},
new double[]{1.7,-1,10,4.83909439961559569e-6},
new double[]{1.7,-0.25,-10,0.00161319003032074674},
new double[]{1.7,-0.25,-4,0.0270389607763099799},
new double[]{1.7,-0.25,-0.5,0.14471714244448391},
new double[]{1.7,-0.25,0,0.159065474424639864},
new double[]{1.7,-0.25,0.5,0.166357138319158912},
new double[]{1.7,-0.25,4,0.0541432282756247292},
new double[]{1.7,-0.25,10,0.00139429377458366754},
new double[]{1.7,0,-10,0.00133348365343831789},
new double[]{1.7,0,-4,0.0282861397850080446},
new double[]{1.7,0,-0.5,0.152654617173119158},
new double[]{1.7,0,0,0.163870984280170003},
new double[]{1.7,0,0.5,0.166975190673575102},
new double[]{1.7,0,4,0.0492014268171709222},
new double[]{1.7,0,10,0.0017779483195426824},
new double[]{1.7,0.375,-10,0.000876539114789763024},
new double[]{1.7,0.375,-4,0.0311475793864698595},
new double[]{1.7,0.375,-0.5,0.161622185801591866},
new double[]{1.7,0.375,0,0.166760071014402456},
new double[]{1.7,0.375,0.5,0.163289266148339929},
new double[]{1.7,0.375,4,0.0437663164176938722},
new double[]{1.7,0.375,10,0.0022951772466629433},
new double[]{1.7,1,-10,3.96847124898336665e-7},
new double[]{1.7,1,-4,0.0410642473516228793},
new double[]{1.7,1,-0.5,0.165127567476394708},
new double[]{1.7,1,0,0.159933057550168853},
new double[]{1.7,1,0.5,0.148126030799541171},
new double[]{1.7,1,4,0.0380228069913886552},
new double[]{1.7,1,10,0.00302940749277748275},
new double[]{2,-1,-10,0.0000136193201517526079},
new double[]{2,-1,-4,0.0304185897697654194},
new double[]{2,-1,-0.5,0.15401134144402122},
new double[]{2,-1,0,0.163322405649358235},
new double[]{2,-1,0.5,0.16586489168167542},
new double[]{2,-1,4,0.0550494776762009875},
new double[]{2,-1,10,0.0000600054567345840717},
new double[]{2,-0.25,-10,0.0000136193201517526079},
new double[]{2,-0.25,-4,0.0304185897697654194},
new double[]{2,-0.25,-0.5,0.15401134144402122},
new double[]{2,-0.25,0,0.163322405649358235},
new double[]{2,-0.25,0.5,0.16586489168167542},
new double[]{2,-0.25,4,0.0550494776762009875},
new double[]{2,-0.25,10,0.0000600054567345840717},
new double[]{2,0,-10,0.0000136193201517526079},
new double[]{2,0,-4,0.0304185897697654194},
new double[]{2,0,-0.5,0.15401134144402122},
new double[]{2,0,0,0.163322405649358235},
new double[]{2,0,0.5,0.16586489168167542},
new double[]{2,0,4,0.0550494776762009875},
new double[]{2,0,10,0.0000600054567345840717},
new double[]{2,0.375,-10,0.0000136193201517526079},
new double[]{2,0.375,-4,0.0304185897697654194},
new double[]{2,0.375,-0.5,0.15401134144402122},
new double[]{2,0.375,0,0.163322405649358235},
new double[]{2,0.375,0.5,0.16586489168167542},
new double[]{2,0.375,4,0.0550494776762009875},
new double[]{2,0.375,10,0.0000600054567345840717},
new double[]{2,1,-10,0.0000136193201517526079},
new double[]{2,1,-4,0.0304185897697654194},
new double[]{2,1,-0.5,0.15401134144402122},
new double[]{2,1,0,0.163322405649358235},
new double[]{2,1,0.5,0.16586489168167542},
new double[]{2,1,4,0.0550494776762009875},
new double[]{2,1,10,0.0000600054567345840717}
     };


    [Test]
    public void PdfTestS1()
    {
      for (int i = 0; i < _pdfTestS0.Length; i++)
      {
        double alpha = _pdfTestS1[i][0];
        double beta = _pdfTestS1[i][1];
        double x = _pdfTestS1[i][2];
        double expectedy = _pdfTestS1[i][3];
        double y = StableDistributionS1.PDF(x, alpha, beta, 1.7, 3.0/7.0);
        double maxdelta = Math.Abs(expectedy / 1E7);
        maxdelta = Math.Max(maxdelta, 1e-25);
        string msg = string.Format("i={0}, alpha={1}, beta={2}, x={3}, expected={4}, actual={5}", i, alpha, beta, x, expectedy, y);
        Assert.AreEqual(expectedy, y, maxdelta, msg);
      }
    }

    #endregion


    #region Test S0 to Feller conversion

    #region Test data

    static readonly double[][] _dataS0ToFeller =
      {
    new double[]{1.421085471520200371742249e-14,-1.0,0,1.421085471520200371742249e-14,0,1.00000000000001753193928,2.232235838725524415666714e-14},
new double[]{1.421085471520200371742249e-14,-1.0,7.888609052210118054117286e-31,1.421085471520200371742249e-14,7.888609052210118054117286e-31,1.00000000000001753193928,2.232235838725524415666714e-14},
new double[]{1.421085471520200371742249e-14,-0.999999999883584678173065,1.16415321826934814453125e-10,1.421085471354764249231643e-14,1.16415321826934814453125e-10,1.000000000000017531939276,2.232235838465657962107864e-14},
new double[]{1.421085471520200371742249e-14,-0.9990234375,0.0009765625,1.419697692739418926066719e-14,0.0009765625,1.000000000000017497713931,2.23005592091426902072954e-14},
new double[]{1.421085471520200371742249e-14,-0.5009765625,0.4990234375,7.119305145408816315466538e-15,0.4990234375,1.000000000000004400122574,1.118297837174017602770532e-14},
new double[]{1.421085471520200371742249e-14,-0.4990234375,0.5009765625,7.091549569793187401955947e-15,0.5009765625,1.000000000000004365880505,1.113938001551506812896183e-14},
new double[]{1.421085471520200371742249e-14,-9.31322574615478515625e-10,0.9999999990686774253845215,1.323488980084844279794254e-23,0.9999999990686774253845215,1.0,2.078931628470797478842283e-23},
new double[]{1.421085471520200371742249e-14,0,1.0,0,1.0,1.0,0},
new double[]{1.421085471520200371742249e-14,9.31322574615478515625e-10,0.9999999990686774253845215,-1.323488980084844279794254e-23,0.9999999990686774253845215,1.0,-2.078931628470797478842283e-23},
new double[]{1.421085471520200371742249e-14,0.4990234375,0.5009765625,-7.091549569793187401955947e-15,0.5009765625,1.000000000000004365880505,-1.113938001551506812896183e-14},
new double[]{1.421085471520200371742249e-14,0.5009765625,0.4990234375,-7.119305145408816315466538e-15,0.4990234375,1.000000000000004400122574,-1.118297837174017602770532e-14},
new double[]{1.421085471520200371742249e-14,0.9990234375,0.0009765625,-1.419697692739418926066719e-14,0.0009765625,1.000000000000017497713931,-2.23005592091426902072954e-14},
new double[]{1.421085471520200371742249e-14,0.999999999883584678173065,1.16415321826934814453125e-10,-1.421085471354764249231643e-14,1.16415321826934814453125e-10,1.000000000000017531939276,-2.232235838465657962107864e-14},
new double[]{1.421085471520200371742249e-14,1.0,7.888609052210118054117286e-31,-1.421085471520200371742249e-14,7.888609052210118054117286e-31,1.00000000000001753193928,-2.232235838725524415666714e-14},
new double[]{1.421085471520200371742249e-14,1.0,0,-1.421085471520200371742249e-14,0,1.00000000000001753193928,-2.232235838725524415666714e-14},
new double[]{0.0009765625,-1.0,0,0.0009765625,0,1.001205512212389417443032,0.001533981991088666528492721},
new double[]{0.0009765625,-1.0,7.888609052210118054117286e-31,0.0009765625,7.888596677107442465675874e-31,1.001205512212389417443032,0.001533981991088666528492721},
new double[]{0.0009765625,-0.999999999883584678173065,1.16415321826934814453125e-10,0.0009765624998863133406224089,1.164151392026532923768237e-10,1.001205512212108568475386,0.001533981990910087521323411},
new double[]{0.0009765625,-0.9990234375,0.0009765625,0.0009756088271774610906049252,0.0009765609702798432205565767,1.001203157433613608988643,0.00153248396180049400258599},
new double[]{0.0009765625,-0.5009765625,0.4990234375,0.000489235211745778997667403,0.4990231431723223063885794,1.000302420225710971146587,0.0007684890248325057901530916},
new double[]{0.0009765625,-0.4990234375,0.5009765625,0.0004873278627389537918389312,0.5009762685553113171569345,1.000300066417490794450945,0.0007654929662561607383396292},
new double[]{0.0009765625,-9.31322574615478515625e-10,0.9999999990686774253845215,9.09495415150035245056378e-13,0.9999999990686766948863639,1.000000000000000000001045,1.42863205735447493241422e-12},
new double[]{0.0009765625,0,1.0,0,1.0,1.0,0},
new double[]{0.0009765625,9.31322574615478515625e-10,0.9999999990686774253845215,-9.09495415150035245056378e-13,0.9999999990686766948863639,1.000000000000000000001045,-1.42863205735447493241422e-12},
new double[]{0.0009765625,0.4990234375,0.5009765625,-0.0004873278627389537918389312,0.5009762685553113171569345,1.000300066417490794450945,-0.0007654929662561607383396292},
new double[]{0.0009765625,0.5009765625,0.4990234375,-0.000489235211745778997667403,0.4990231431723223063885794,1.000302420225710971146587,-0.0007684890248325057901530916},
new double[]{0.0009765625,0.9990234375,0.0009765625,-0.0009756088271774610906049252,0.0009765609702798432205565767,1.001203157433613608988643,-0.00153248396180049400258599},
new double[]{0.0009765625,0.999999999883584678173065,1.16415321826934814453125e-10,-0.0009765624998863133406224089,1.164151392026532923768237e-10,1.001205512212108568475386,-0.001533981990910087521323411},
new double[]{0.0009765625,1.0,7.888609052210118054117286e-31,-0.0009765625,7.888596677107442465675874e-31,1.001205512212389417443032,-0.001533981991088666528492721},
new double[]{0.0009765625,1.0,0,-0.0009765625,0,1.001205512212389417443032,-0.001533981991088666528492721},
new double[]{0.125,-1.0,0,0.125,0,1.167907601843724847691026,0.1989123673796580069115976},
new double[]{0.125,-1.0,7.888609052210118054117286e-31,0.125,7.687412905645950709634956e-31,1.167907601843724847691026,0.1989123673796580069115976},
new double[]{0.125,-0.999999999883584678173065,1.16415321826934814453125e-10,0.1249999999858192261539989,1.134461907680088693337928e-10,1.16790760180232678037051,0.1989123673565015596477372},
new double[]{0.125,-0.9990234375,0.0009765625,0.1248810386268746048501893,0.0009516909850031611984852038,1.167560537934192606738989,0.198718117020888809639223},
new double[]{0.125,-0.5009765625,0.4990234375,0.06323069001949552220421024,0.4941544798440358223663181,1.040316416887408361724855,0.09965043404859820072817342},
new double[]{0.125,-0.4990234375,0.5009765625,0.06298578526739967905367389,0.4961137178608025675706089,1.039998042703580133016094,0.0992619333310598061834242},
new double[]{0.125,-9.31322574615478515625e-10,0.9999999990686774253845215,1.179348174876855620670468e-10,0.9999999990565214600985155,1.000000000000000000137273,1.852515781108830188509055e-10},
new double[]{0.125,0,1.0,0,1.0,1.0,0},
new double[]{0.125,9.31322574615478515625e-10,0.9999999990686774253845215,-1.179348174876855620670468e-10,0.9999999990565214600985155,1.000000000000000000137273,-1.852515781108830188509055e-10},
new double[]{0.125,0.4990234375,0.5009765625,-0.06298578526739967905367389,0.4961137178608025675706089,1.039998042703580133016094,-0.0992619333310598061834242},
new double[]{0.125,0.5009765625,0.4990234375,-0.06323069001949552220421024,0.4941544798440358223663181,1.040316416887408361724855,-0.09965043404859820072817342},
new double[]{0.125,0.9990234375,0.0009765625,-0.1248810386268746048501893,0.0009516909850031611984852038,1.167560537934192606738989,-0.198718117020888809639223},
new double[]{0.125,0.999999999883584678173065,1.16415321826934814453125e-10,-0.1249999999858192261539989,1.134461907680088693337928e-10,1.16790760180232678037051,-0.1989123673565015596477372},
new double[]{0.125,1.0,7.888609052210118054117286e-31,-0.125,7.687412905645950709634956e-31,1.167907601843724847691026,-0.1989123673796580069115976},
new double[]{0.125,1.0,0,-0.125,0,1.167907601843724847691026,-0.1989123673796580069115976},
new double[]{0.875,-1.0,0,0.875,0,6.473798397343406296281724,5.027339492125848104514975},
new double[]{0.875,-1.0,7.888609052210118054117286e-31,0.875,1.098201843663707244233565e-31,6.473798397343406296281724,5.027339492125848104514975},
new double[]{0.875,-0.999999999883584678173065,1.16415321826934814453125e-10,0.8749999999858192261524737,1.620659868288720437985489e-11,6.473798396514874576928266,5.027339491540588759605885},
new double[]{0.875,-0.9990234375,0.0009765625,0.8748809311959006262923247,0.0001360786332564270944860354,6.466848765284605174598834,5.02242998090306895597541},
new double[]{0.875,-0.5009765625,0.4990234375,0.7593831654091330049745631,0.1321335252467051371719279,3.124589968761433802796851,2.518579257285703200797053},
new double[]{0.875,-0.4990234375,0.5009765625,0.758529032694736458094618,0.133109676920301190749008,3.112570070292761005241727,2.508760234840144903717922},
new double[]{0.875,-9.31322574615478515625e-10,0.9999999990686774253845215,2.98070136745619531239224e-9,0.9999999965934841514786339,1.000000000000000012526757,4.682074759272717036786466e-9},
new double[]{0.875,0,1.0,0,1.0,1.0,0},
new double[]{0.875,9.31322574615478515625e-10,0.9999999990686774253845215,-2.98070136745619531239224e-9,0.9999999965934841514786339,1.000000000000000012526757,-4.682074759272717036786466e-9},
new double[]{0.875,0.4990234375,0.5009765625,-0.758529032694736458094618,0.133109676920301190749008,3.112570070292761005241727,-2.508760234840144903717922},
new double[]{0.875,0.5009765625,0.4990234375,-0.7593831654091330049745631,0.1321335252467051371719279,3.124589968761433802796851,-2.518579257285703200797053},
new double[]{0.875,0.9990234375,0.0009765625,-0.8748809311959006262923247,0.0001360786332564270944860354,6.466848765284605174598834,-5.02242998090306895597541},
new double[]{0.875,0.999999999883584678173065,1.16415321826934814453125e-10,-0.8749999999858192261524737,1.620659868288720437985489e-11,6.473798396514874576928266,-5.027339491540588759605885},
new double[]{0.875,1.0,7.888609052210118054117286e-31,-0.875,1.098201843663707244233565e-31,6.473798397343406296281724,-5.027339492125848104514975},
new double[]{0.875,1.0,0,-0.875,0,6.473798397343406296281724,-5.027339492125848104514975},
new double[]{0.9990234375,-1.0,0,0.9990234375,0,656.0412678808089694324694,651.8981355773937866181086},
new double[]{0.9990234375,-1.0,7.888609052210118054117286e-31,0.9990234375,7.711238198540999477689026e-34,656.0412678808089694324694,651.8981355773937866181086},
new double[]{0.9990234375,-0.999999999883584678173065,1.16415321826934814453125e-10,0.9990234374998863133406092,1.137977900451668958881058e-13,656.0412678043612378260236,651.8981355015028553664875},
new double[]{0.9990234375,-0.9990234375,0.0009765625,0.9990224828949503524122506,9.555381924136166719745401e-7,655.3999781347995037493598,651.2615163043689879983644},
new double[]{0.9990234375,-0.5009765625,0.4990234375,0.9980506868243005669089475,0.000973701556125336740212855,328.4404666836085127909157,326.5856870617216919287986},
new double[]{0.9990234375,-0.4990234375,0.5009765625,0.9980430574664923411693048,0.0009813383717613320064828129,327.1587598328629640622672,325.3124485156720946893101},
new double[]{0.9990234375,-9.31322574615478515625e-10,0.9999999990686774253845215,3.865093390253187356978073e-7,0.9999996131128414839429273,1.000000000000184482028511,6.07127450012968654388663e-7},
new double[]{0.9990234375,0,1.0,0,1.0,1.0,0},
new double[]{0.9990234375,9.31322574615478515625e-10,0.9999999990686774253845215,-3.865093390253187356978073e-7,0.9999996131128414839429273,1.000000000000184482028511,-6.07127450012968654388663e-7},
new double[]{0.9990234375,0.4990234375,0.5009765625,-0.9980430574664923411693048,0.0009813383717613320064828129,327.1587598328629640622672,-325.3124485156720946893101},
new double[]{0.9990234375,0.5009765625,0.4990234375,-0.9980506868243005669089475,0.000973701556125336740212855,328.4404666836085127909157,-326.5856870617216919287986},
new double[]{0.9990234375,0.9990234375,0.0009765625,-0.9990224828949503524122506,9.555381924136166719745401e-7,655.3999781347995037493598,-651.2615163043689879983644},
new double[]{0.9990234375,0.999999999883584678173065,1.16415321826934814453125e-10,-0.9990234374998863133406092,1.137977900451668958881058e-13,656.0412678043612378260236,-651.8981355015028553664875},
new double[]{0.9990234375,1.0,7.888609052210118054117286e-31,-0.9990234375,7.711238198540999477689026e-34,656.0412678808089694324694,-651.8981355773937866181086},
new double[]{0.9990234375,1.0,0,-0.9990234375,0,656.0412678808089694324694,-651.8981355773937866181086},
new double[]{0.999999999999985789145285,-1.0,0,0.999999999999985789145285,0,4.479813390019703165670747e13,4.479813390017702066797247e13},
new double[]{0.999999999999985789145285,-1.0,7.888609052210118054117286e-31,0.999999999999985789145285,1.121038771459869587658095e-44,4.479813390019703165670747e13,4.479813390017702066797247e13},
new double[]{0.999999999999985789145285,-0.999999999883584678173065,1.16415321826934814453125e-10,0.999999999999985789145283,1.654361225298671854090981e-24,4.479813389498184248146984e13,4.479813389496183149273724e13},
new double[]{0.999999999999985789145285,-0.9990234375,0.0009765625,0.999999999999985775253931,1.389135358279785500079592e-17,4.475438572256011987158489e13,4.47543857225401290462264e13},
new double[]{0.999999999999985789145285,-0.5009765625,0.4990234375,0.999999999999971633693512,1.415545177284274287569409e-14,2.244281512773520654785766e13,2.24428151277254019557323e13},
new double[]{0.999999999999985789145285,-0.4990234375,0.5009765625,0.999999999999971522670786,1.426647449882334932791134e-14,2.235531877246138383886376e13,2.235531877245161871224017e13},
new double[]{0.999999999999985789145285,-9.31322574615478515625e-10,0.9999999990686774253845215,0.999984741210940421989879,0.00001525878904536737224623112,41721.51341387234351407375,41721.51340188181089979827},
new double[]{0.999999999999985789145285,0,1.0,0,1.0,1.0,0},
new double[]{0.999999999999985789145285,9.31322574615478515625e-10,0.9999999990686774253845215,-0.999984741210940421989879,0.00001525878904536737224623112,41721.51341387234351407375,-41721.51340188181089979827},
new double[]{0.999999999999985789145285,0.4990234375,0.5009765625,-0.999999999999971522670786,1.426647449882334932791134e-14,2.235531877246138383886376e13,-2.235531877245161871224017e13},
new double[]{0.999999999999985789145285,0.5009765625,0.4990234375,-0.999999999999971633693512,1.415545177284274287569409e-14,2.244281512773520654785766e13,-2.24428151277254019557323e13},
new double[]{0.999999999999985789145285,0.9990234375,0.0009765625,-0.999999999999985775253931,1.389135358279785500079592e-17,4.475438572256011987158489e13,-4.47543857225401290462264e13},
new double[]{0.999999999999985789145285,0.999999999883584678173065,1.16415321826934814453125e-10,-0.999999999999985789145283,1.654361225298671854090981e-24,4.479813389498184248146984e13,-4.479813389496183149273724e13},
new double[]{0.999999999999985789145285,1.0,7.888609052210118054117286e-31,-0.999999999999985789145285,1.121038771459869587658095e-44,4.479813390019703165670747e13,-4.479813390017702066797247e13},
new double[]{0.999999999999985789145285,1.0,0,-0.999999999999985789145285,0,4.479813390019703165670747e13,-4.479813390017702066797247e13},
new double[]{1.000000000000014210854715,-1.0,0,-0.999999999999985789145285,0,4.479813390015700967923748e13,-4.479813390017702066797247e13},
new double[]{1.000000000000014210854715,-1.0,7.888609052210118054117286e-31,-0.999999999999985789145285,1.121038771459853656738984e-44,4.479813390015700967923748e13,-4.479813390017702066797247e13},
new double[]{1.000000000000014210854715,-0.999999999883584678173065,1.16415321826934814453125e-10,-0.999999999999985789145283,1.654361225298648344203962e-24,4.479813389494182050400466e13,-4.479813389496183149273724e13},
new double[]{1.000000000000014210854715,-0.9990234375,0.0009765625,-0.999999999999985775253931,1.389135358279765759278835e-17,4.475438572252013822086793e13,-4.47543857225401290462264e13},
new double[]{1.000000000000014210854715,-0.5009765625,0.4990234375,-0.999999999999971633693512,1.415545177284254171462552e-14,2.244281512771559736360695e13,-2.24428151277254019557323e13},
new double[]{1.000000000000014210854715,-0.4990234375,0.5009765625,-0.999999999999971522670786,1.426647449882314658911494e-14,2.235531877244185358561658e13,-2.235531877245161871224017e13},
new double[]{1.000000000000014210854715,-9.31322574615478515625e-10,0.9999999990686774253845215,-0.999984741210940421989879,0.00001525878904536715540579687,41721.51341385972809279354,-41721.51340188181089979827},
new double[]{1.000000000000014210854715,0,1.0,0,0.999999999999985789145285,1.0,0},
new double[]{1.000000000000014210854715,9.31322574615478515625e-10,0.9999999990686774253845215,0.999984741210940421989879,0.00001525878904536715540579687,41721.51341385972809279354,41721.51340188181089979827},
new double[]{1.000000000000014210854715,0.4990234375,0.5009765625,0.999999999999971522670786,1.426647449882314658911494e-14,2.235531877244185358561658e13,2.235531877245161871224017e13},
new double[]{1.000000000000014210854715,0.5009765625,0.4990234375,0.999999999999971633693512,1.415545177284254171462552e-14,2.244281512771559736360695e13,2.24428151277254019557323e13},
new double[]{1.000000000000014210854715,0.9990234375,0.0009765625,0.999999999999985775253931,1.389135358279765759278835e-17,4.475438572252013822086793e13,4.47543857225401290462264e13},
new double[]{1.000000000000014210854715,0.999999999883584678173065,1.16415321826934814453125e-10,0.999999999999985789145283,1.654361225298648344203962e-24,4.479813389494182050400466e13,4.479813389496183149273724e13},
new double[]{1.000000000000014210854715,1.0,7.888609052210118054117286e-31,0.999999999999985789145285,1.121038771459853656738984e-44,4.479813390015700967923748e13,4.479813390017702066797247e13},
new double[]{1.000000000000014210854715,1.0,0,0.999999999999985789145285,0,4.479813390015700967923748e13,4.479813390017702066797247e13},
new double[]{1.0009765625,-1.0,0,-0.9990234375,0,647.7906991800191676449892,-651.8981355773937866181086},
new double[]{1.0009765625,-1.0,7.888609052210118054117286e-31,-0.9990234375,7.703707692487736782886596e-34,647.7906991800191676449892,-651.8981355773937866181086},
new double[]{1.0009765625,-0.999999999883584678173065,1.16415321826934814453125e-10,-0.9990234374998863133406092,1.136866593908259125913401e-13,647.7906991046801556307789,-651.8981355015028553664875},
new double[]{1.0009765625,-0.9990234375,0.0009765625,-0.9990224828949503524122506,9.54605049647587749443315e-7,647.158709440692072714048,-651.2615163043689879983644},
new double[]{1.0009765625,-0.5009765625,0.4990234375,-0.9980506868243005669089475,0.0009727506756994330910524909,324.7480120501059979884766,-326.5856870617216919287986},
new double[]{1.0009765625,-0.4990234375,0.5009765625,-0.9980430574664923411693048,0.0009803800335076588306952321,323.4831825966909490536702,-325.3124485156720946893101},
new double[]{1.0009765625,-9.31322574615478515625e-10,0.9999999990686774253845215,-3.865093390253187356978073e-7,0.9990230509906609746812643,1.000000000000184122063577,-6.07127450012968654388663e-7},
new double[]{1.0009765625,0,1.0,0,0.9990234375,1.0,0},
new double[]{1.0009765625,9.31322574615478515625e-10,0.9999999990686774253845215,3.865093390253187356978073e-7,0.9990230509906609746812643,1.000000000000184122063577,6.07127450012968654388663e-7},
new double[]{1.0009765625,0.4990234375,0.5009765625,0.9980430574664923411693048,0.0009803800335076588306952321,323.4831825966909490536702,325.3124485156720946893101},
new double[]{1.0009765625,0.5009765625,0.4990234375,0.9980506868243005669089475,0.0009727506756994330910524909,324.7480120501059979884766,326.5856870617216919287986},
new double[]{1.0009765625,0.9990234375,0.0009765625,0.9990224828949503524122506,9.54605049647587749443315e-7,647.158709440692072714048,651.2615163043689879983644},
new double[]{1.0009765625,0.999999999883584678173065,1.16415321826934814453125e-10,0.9990234374998863133406092,1.136866593908259125913401e-13,647.7906991046801556307789,651.8981355015028553664875},
new double[]{1.0009765625,1.0,7.888609052210118054117286e-31,0.9990234375,7.703707692487736782886596e-34,647.7906991800191676449892,651.8981355773937866181086},
new double[]{1.0009765625,1.0,0,0.9990234375,0,647.7906991800191676449892,651.8981355773937866181086},
new double[]{1.25,-1.0,0,-0.75,0,2.156394778388108482533962,-2.414213562373095048801689},
new double[]{1.25,-1.0,7.888609052210118054117286e-31,-0.75,1.775560860372353376714565e-31,2.156394778388108482533962,-2.414213562373095048801689},
new double[]{1.25,-0.999999999883584678173065,1.16415321826934814453125e-10,-0.7499999999737973465745289,2.620265342547114485205664e-11,2.156394778216689428771426,-2.414213562092043599979074},
new double[]{1.25,-0.9990234375,0.0009765625,-0.7497800128507249415104925,0.0002199871492750584895075018,2.154956794168735461856732,-2.411855931941090073168093},
new double[]{1.25,-0.5009765625,0.4990234375,-0.5601737810520340754074506,0.1898262189479659245925494,1.434075286374479926452832,-1.20946441161855250003444},
new double[]{1.25,-0.4990234375,0.5009765625,-0.5589520875437814456372665,0.1910479124562185543627335,1.431420150405464919467672,-1.204749150754542548767249},
new double[]{1.25,-9.31322574615478515625e-10,0.9999999990686774253845215,-1.431383274984254883640274e-9,0.7499999985686167250157451,1.000000000000000002022142,-2.24841159058091700896778e-9},
new double[]{1.25,0,1.0,0,0.75,1.0,0},
new double[]{1.25,9.31322574615478515625e-10,0.9999999990686774253845215,1.431383274984254883640274e-9,0.7499999985686167250157451,1.000000000000000002022142,2.24841159058091700896778e-9},
new double[]{1.25,0.4990234375,0.5009765625,0.5589520875437814456372665,0.1910479124562185543627335,1.431420150405464919467672,1.204749150754542548767249},
new double[]{1.25,0.5009765625,0.4990234375,0.5601737810520340754074506,0.1898262189479659245925494,1.434075286374479926452832,1.20946441161855250003444},
new double[]{1.25,0.9990234375,0.0009765625,0.7497800128507249415104925,0.0002199871492750584895075018,2.154956794168735461856732,2.411855931941090073168093},
new double[]{1.25,0.999999999883584678173065,1.16415321826934814453125e-10,0.7499999999737973465745289,2.620265342547114485205664e-11,2.156394778216689428771426,2.414213562092043599979074},
new double[]{1.25,1.0,7.888609052210118054117286e-31,0.75,1.775560860372353376714565e-31,2.156394778388108482533962,2.414213562373095048801689},
new double[]{1.25,1.0,0,0.75,0,2.156394778388108482533962,2.414213562373095048801689},
new double[]{1.9990234375,-1.0,0,-0.0009765625,0,1.000000588562052044261124,-0.001533981991088666528492721},
new double[]{1.9990234375,-1.0,7.888609052210118054117286e-31,-0.0009765625,7.703707692487736782886596e-34,1.000000588562052044261124,-0.001533981991088666528492721},
new double[]{1.9990234375,-0.999999999883584678173065,1.16415321826934814453125e-10,-0.0009765624998863133406224089,1.136866593775911058367419e-13,1.000000588562051907225963,-0.001533981990910087521323411},
new double[]{1.9990234375,-0.9990234375,0.0009765625,-0.0009756088271774610906049252,9.536728225389093950747819e-7,1.000000587413079094598226,-0.00153248396180049400258599},
new double[]{1.9990234375,-0.5009765625,0.4990234375,-0.000489235211745778997667403,0.000487327288254221002332597,1.000000147715939552891955,-0.0007684890248325057901530916},
new double[]{1.9990234375,-0.4990234375,0.5009765625,-0.0004873278627389537918389312,0.0004892346372610462081610688,1.000000146566403787895913,-0.0007654929662561607383396292},
new double[]{1.9990234375,-9.31322574615478515625e-10,0.9999999990686774253845215,-9.09495415150035245056378e-13,0.0009765624990905045848499648,1.000000000000000000000001,-1.42863205735447493241422e-12},
new double[]{1.9990234375,0,1.0,0,0.0009765625,1.0,0},
new double[]{1.9990234375,9.31322574615478515625e-10,0.9999999990686774253845215,9.09495415150035245056378e-13,0.0009765624990905045848499648,1.000000000000000000000001,1.42863205735447493241422e-12},
new double[]{1.9990234375,0.4990234375,0.5009765625,0.0004873278627389537918389312,0.0004892346372610462081610688,1.000000146566403787895913,0.0007654929662561607383396292},
new double[]{1.9990234375,0.5009765625,0.4990234375,0.000489235211745778997667403,0.000487327288254221002332597,1.000000147715939552891955,0.0007684890248325057901530916},
new double[]{1.9990234375,0.9990234375,0.0009765625,0.0009756088271774610906049252,9.536728225389093950747819e-7,1.000000587413079094598226,0.00153248396180049400258599},
new double[]{1.9990234375,0.999999999883584678173065,1.16415321826934814453125e-10,0.0009765624998863133406224089,1.136866593775911058367419e-13,1.000000588562051907225963,0.001533981990910087521323411},
new double[]{1.9990234375,1.0,7.888609052210118054117286e-31,0.0009765625,7.703707692487736782886596e-34,1.000000588562052044261124,0.001533981991088666528492721},
new double[]{1.9990234375,1.0,0,0.0009765625,0,1.000000588562052044261124,0.001533981991088666528492721},
new double[]{1.999999999999985789145285,-1.0,0,-1.421085471520200371742249e-14,0,1.0,-2.232235838725524415666714e-14},
new double[]{1.999999999999985789145285,-1.0,7.888609052210118054117286e-31,-1.421085471520200371742249e-14,1.121038771459853656738984e-44,1.0,-2.232235838725524415666714e-14},
new double[]{1.999999999999985789145285,-0.999999999883584678173065,1.16415321826934814453125e-10,-1.421085471354764249231643e-14,1.654361225106055349742817e-24,1.0,-2.232235838465657962107864e-14},
new double[]{1.999999999999985789145285,-0.9990234375,0.0009765625,-1.419697692739418926066719e-14,1.38777878078144567552954e-17,1.0,-2.23005592091426902072954e-14},
new double[]{1.999999999999985789145285,-0.5009765625,0.4990234375,-7.119305145408816315466538e-15,7.091549569793187401955947e-15,1.0,-1.118297837174017602770532e-14},
new double[]{1.999999999999985789145285,-0.4990234375,0.5009765625,-7.091549569793187401955947e-15,7.119305145408816315466538e-15,1.0,-1.113938001551506812896183e-14},
new double[]{1.999999999999985789145285,-9.31322574615478515625e-10,0.9999999990686774253845215,-1.323488980084844279794254e-23,1.421085470196711391657404e-14,1.0,-2.078931628470797478842283e-23},
new double[]{1.999999999999985789145285,0,1.0,0,1.421085471520200371742249e-14,1.0,0},
new double[]{1.999999999999985789145285,9.31322574615478515625e-10,0.9999999990686774253845215,1.323488980084844279794254e-23,1.421085470196711391657404e-14,1.0,2.078931628470797478842283e-23},
new double[]{1.999999999999985789145285,0.4990234375,0.5009765625,7.091549569793187401955947e-15,7.119305145408816315466538e-15,1.0,1.113938001551506812896183e-14},
new double[]{1.999999999999985789145285,0.5009765625,0.4990234375,7.119305145408816315466538e-15,7.091549569793187401955947e-15,1.0,1.118297837174017602770532e-14},
new double[]{1.999999999999985789145285,0.9990234375,0.0009765625,1.419697692739418926066719e-14,1.38777878078144567552954e-17,1.0,2.23005592091426902072954e-14},
new double[]{1.999999999999985789145285,0.999999999883584678173065,1.16415321826934814453125e-10,1.421085471354764249231643e-14,1.654361225106055349742817e-24,1.0,2.232235838465657962107864e-14},
new double[]{1.999999999999985789145285,1.0,7.888609052210118054117286e-31,1.421085471520200371742249e-14,1.121038771459853656738984e-44,1.0,2.232235838725524415666714e-14},
new double[]{1.999999999999985789145285,1.0,0,1.421085471520200371742249e-14,0,1.0,2.232235838725524415666714e-14},
new double[]{2.0,-1.0,0,0,0,1.0,0},
new double[]{2.0,-1.0,7.888609052210118054117286e-31,0,0,1.0,0},
new double[]{2.0,-0.999999999883584678173065,1.16415321826934814453125e-10,0,0,1.0,0},
new double[]{2.0,-0.9990234375,0.0009765625,0,0,1.0,0},
new double[]{2.0,-0.5009765625,0.4990234375,0,0,1.0,0},
new double[]{2.0,-0.4990234375,0.5009765625,0,0,1.0,0},
new double[]{2.0,-9.31322574615478515625e-10,0.9999999990686774253845215,0,0,1.0,0},
new double[]{2.0,0,1.0,0,0,1.0,0},
new double[]{2.0,9.31322574615478515625e-10,0.9999999990686774253845215,0,0,1.0,0},
new double[]{2.0,0.4990234375,0.5009765625,0,0,1.0,0},
new double[]{2.0,0.5009765625,0.4990234375,0,0,1.0,0},
new double[]{2.0,0.9990234375,0.0009765625,0,0,1.0,0},
new double[]{2.0,0.999999999883584678173065,1.16415321826934814453125e-10,0,0,1.0,0},
new double[]{2.0,1.0,7.888609052210118054117286e-31,0,0,1.0,0},
new double[]{2.0,1.0,0,0,0,1.0,0}

      };
#endregion

    #region Forward test
    static double Tolerance(double expected, double actual)
    {
      if (expected == 0)
        return Math.Abs(actual);
      else
        return Math.Abs((actual - expected) / expected);
    }

    [Test]
    public void TestS0ToFellerConversion()
    {
      double tol = DoubleConstants.DBL_EPSILON;

      double maxtolgamma=0, maxtolaga=0, maxtolsigmaf=0, maxtolmuf=0;
      int maxtolgammai=-1, maxtolagai=-1, maxtolsigmafi=-1, maxtolmufi=-1;
      double t;

      for(int i=0;i<_dataS0ToFeller.Length;i++)
      {

        double alpha = _dataS0ToFeller[i][0];
        double beta = _dataS0ToFeller[i][1];
        double abe = _dataS0ToFeller[i][2];
        double expgamma = _dataS0ToFeller[i][3];
        double expaga = _dataS0ToFeller[i][4];
        double expsigmaf = _dataS0ToFeller[i][5];
        double expmuf = _dataS0ToFeller[i][6];


        double gamma, aga, sigmaf, muf;
        StableDistributionBase.ParameterConversionS0ToFeller(alpha, beta, abe, 1, 0, out gamma, out aga, out sigmaf, out muf);

        t = Tolerance(expgamma, gamma);
        if (t > maxtolgamma)
        {
          maxtolgamma = t;
          maxtolgammai = i;
        }
        
        t = Tolerance(expaga, aga);
        if (t > maxtolaga)
        {
          maxtolaga = t;
          maxtolagai = i;
        }

        t = Tolerance(expsigmaf, sigmaf);
        if (t > maxtolsigmaf)
        {
          maxtolsigmaf = t;
          maxtolsigmafi = i;
        }

        t = Tolerance(expmuf, muf);
        if (t > maxtolmuf)
        {
          maxtolmuf = t;
          maxtolmufi = i;
        }
      
      }

      /*
      string msg = string.Format("Gamma, i={0}, alpha={1}, beta={2}, abe={3}, expected={4}, actual={5}", maxtolgammai, alpha, beta, abe, expgamma, gamma);
      Assert.AreEqual(expgamma, gamma, expgamma * tol * 10, msg);

      msg = string.Format("Aga, i={0}, alpha={1}, beta={2}, abe={3}, expected={4}, actual={5}", i, alpha, beta, abe, expaga, aga);
      Assert.AreEqual(expaga, aga, expaga * tol * 4000, msg);

      msg = string.Format("Sigmaf, i={0}, alpha={1}, beta={2}, abe={3}, expected={4}, actual={5}", i, alpha, beta, abe, expsigmaf, sigmaf);
      Assert.AreEqual(expsigmaf, sigmaf, expsigmaf * tol * 4, msg);

      msg = string.Format("Muf, i={0}, alpha={1}, beta={2}, abe={3}, expected={4}, actual={5}", i, alpha, beta, abe, expmuf, muf);
      Assert.AreEqual(expmuf, muf, expmuf * tol * 4, msg);
      */

      string msg;

      msg = String.Format("Gamma, i={0}", maxtolgammai);
      Assert.Less(1, maxtolgamma/DoubleConstants.DBL_EPSILON, msg);
      msg = String.Format("Aga, i={0}", maxtolagai);
      Assert.Less(1, maxtolaga / DoubleConstants.DBL_EPSILON, msg);
      msg = String.Format("Sigmaf, i={0}", maxtolsigmafi);
      Assert.Less(1, maxtolsigmaf / DoubleConstants.DBL_EPSILON, msg);
      msg = String.Format("Muf, i={0}", maxtolmufi);
      Assert.Less(1, maxtolmuf / DoubleConstants.DBL_EPSILON, msg);
    }

    [Test]
    public void TestS0Aeq1()
    {
      double alpha=1;
      double abe = 0;
      double beta = 1+abe;
      double x = 10;
      double precision = Math.Sqrt(DoubleConstants.DBL_EPSILON);
      object temp=null;

      StableDistributionS0.Aeq1BpD dec = new StableDistributionS0.Aeq1BpD(x, beta, abe);
      double ycore = dec.PDFCore(1.0/3.0);

      double y1 = StableDistributionS0.PDF(x, alpha, beta, abe, ref temp, precision);
      double y2 = StableDistributionS0.PDFMethodAlphaOne(x, beta, abe, ref temp, precision);

      Assert.AreEqual(y1, y2, y1 * precision);
    }

    [Test]
    public void TestFellerToS0Conversion()
    {
      double tol = DoubleConstants.DBL_EPSILON;

      double maxtolbeta = 0, maxtolabe = 0, maxtolsigma0 = 0, maxtolmu0 = 0;
      int maxtolbetai = -1, maxtolabei = -1, maxtolsigma0i = -1, maxtolmu0i = -1;
      double t;

      for (int i = 0; i < _dataS0ToFeller.Length; i++)
      {

        double alpha = _dataS0ToFeller[i][0];
        double expbeta = _dataS0ToFeller[i][1];
        double expabe = _dataS0ToFeller[i][2];
        double gamma = _dataS0ToFeller[i][3];
        double aga = _dataS0ToFeller[i][4];
        double sigmaf = _dataS0ToFeller[i][5];
        double muf = _dataS0ToFeller[i][6];

        if (alpha == 2)
          continue;


        double beta, abe, sigma0, mu0, expsigma0=1, expmu0=0;
        StableDistributionBase.ParameterConversionFellerToS0(alpha, gamma, aga,  sigmaf, muf, out beta, out abe, out sigma0, out mu0);

        t = Tolerance(expbeta, beta);
        if (t > maxtolbeta)
        {
          maxtolbeta = t;
          maxtolbetai = i;
        }

        t = Tolerance(expabe, abe);
        if (t > maxtolabe)
        {
          maxtolabe = t;
          maxtolabei = i;
        }

        t = Tolerance(expsigma0, sigma0);
        if (t > maxtolsigma0)
        {
          maxtolsigma0 = t;
          maxtolsigma0i = i;
        }

        t = Tolerance(expmu0, mu0 / muf);
        if (t > maxtolmu0)
        {
          maxtolmu0 = t;
          maxtolmu0i = i;
        }

      }

     

      string msg;

      msg = String.Format("beta, i={0}", maxtolbetai);
      Assert.Less(1, maxtolbeta / DoubleConstants.DBL_EPSILON, msg);
      msg = String.Format("abe, i={0}", maxtolabei);
      Assert.Less(1, maxtolabe / DoubleConstants.DBL_EPSILON, msg);
      msg = String.Format("Sigma0, i={0}", maxtolsigma0i);
      Assert.Less(1, maxtolsigma0 / DoubleConstants.DBL_EPSILON, msg);
      msg = String.Format("Mu0, i={0}", maxtolmu0i);
      Assert.Less(1, maxtolmu0 / DoubleConstants.DBL_EPSILON, msg);
    }

    #endregion

    #endregion
  }
}
